{% extends "base.html" %}

<head>
    <title>Login</title>
    <!-- CSS only -->
  
    <link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css rel="stylesheet"
    integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="shortcut icon" href=https://d10f050hr6w2l2.cloudfront.net/zexpense/assets/images/favicon.ico>
    <!-- our project just needs Font Awesome Solid + Brands -->
    <!-- JavaScript Bundle with Popper -->
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  
    <script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js
    integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous">
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap');
    
      *{
        font-family: 'Poppins', sans-serif;
      }
      .homelink:hover {background-color:rebeccapurple;}
      
    </style>
        <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
        <script src=https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js></script>
        <!-- CSS only -->
        <link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css rel="stylesheet"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        <!-- JavaScript Bundle with Popper -->
        <script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js
          integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous">
        </script>
            <script>
              $(document).ready(function () {      
                $("#mymodal").modal('show')
              });

              $(document).ready(function() {
                    var today = new Date().toISOString().split('T')[0];
                    $('input[type="date"]').attr('min', today);
                });
        </script>

        
  {% load static %}
</head>
<!-- {% block content %} -->

{% for msg in messages %}
  {% if msg %}
    <div class="modal fade" tabindex="-1" role="dialog" id="mymodal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Information Message</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>{{ msg }}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        $("#mymodal").modal('show');
      });
    </script>
  {% endif %}
{% endfor %}

  <!-- <div class="container-fluid">
    <div class="row">
        <div class="col-5" style="margin-top:6%">
            <h4>Add Role</h4>
            <form action="" method="post">
                {% csrf_token %}
                {{form.as_p}}
            <input class="btn" id="save" style="background-color: rgb(52,49,49);color: white;width: 100%;" type="submit" name="role"
                  value="Save" >
            </form>
        </div>
    </div>
  </div> -->
<!-- <div class="container-fluid" >    -->
    <div class="row" style="margin-top:7%; margin-right: 3%; margin-left: 3%;">
        <nav class="navbar navbar-expand-lg navbar-light bg-light" style="margin-right:18%;">
            <div class="container-md" style="margin-left:2px;">
              <a class="navbar-brand" href="#"><h6 style="font-size: large;"><b>Assign Profile</b></h6></a>
            </div>
            <div class="col-md-1" style="margin-right: -85px;">
              <a href="{% url 'home' %}" style="color: #181819;font-size: larger;"><i class="fa-solid fa-arrow-left"></i></a>
            </div>
        </nav>
    </div>
    <div class="row" style="margin-top:2%; margin-right: 3%; margin-left: 3%;">

    <!-- <form method="POST" action="" class="travel_form" novalidate style="padding:5px;">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-2" style="margin-top:8px;">
          <label for="grade"><b>Profile Name :</b></label>
        </div>
        <div class="col-md-4">
          {{form.TPFCNAME}}
          {{form.TPFCNAME.errors}}
        </div>
        <div class="col-md-2" style="margin-top:8px;">
          <label for="Description"><b>Level 1 : </b></label>
        </div>
        <div class="col-md-3">
          {{form.TPFCMANID}}
        </div>
        <div class="col-md-1" style="margin-top: 5px;">
        <i class="fa-solid fa-plus fa-lg add-form"></i>
        </div>
      </div>
    <div class="col-md-2" style="margin-top:20px;">
      <button type="submit" style="width: 109px;" class="btn btn-primary" >Submit</button>
    </div>
    
    </form> -->

    <form method="POST" action="" class="travel_form" novalidate style="padding:5px;">
      {% csrf_token %}
      <!-- {{ form.as_p }} -->
      {{ multiprofile_formset.management_form }}
      <div class="row">
        <div class="col-md-2" style="margin-top:8px;">
          <label for="grade"><b>Employee Name :</b></label>
        </div>
        <div class="col-md-4">
          {{ form.TPFAEMPID }}
          {{ form.TPFAEMPID.errors }}
        </div>
        <div class="col-md-2" style="margin-top:8px;">
          <label for="Description"><b>Profile Name : </b></label>
        </div>
        <div class="col-md-4">
          {{ form.TPFAPRNAME }}
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-2" style="margin-top:8px;">
          <label for="grade"><b>From Date :</b></label>
        </div>
        <div class="col-md-4">
          {{ form.TPFAFROMD }}
          {{ form.TPFAFROMD.errors }}
        </div>
        <div class="col-md-2" style="margin-top:8px;">
          <label for="Description"><b>To Date : </b></label>
        </div>
        <div class="col-md-4">
          {{ form.TPFATODATE }}
        </div>
      </div>
      <br>
      <div class="col-md-2" style="margin-top:20px;">
        <button type="submit" style="width: 109px;" class="btn btn-primary">Submit</button>
      </div>
    </form>



    </div>
<!-- </div> -->
    <div class="row" style="margin-top:20px; margin-right: 3%; margin-left: 3%;">
        <nav class="navbar navbar-expand-lg navbar-light bg-light" style="margin-right:18%;">
            <div class="container-md" style="margin-left:2px;">
              <a class="navbar-brand" href="#"><h6 style="font-size: large;"><b>Data</b></h6></a>
            </div>
        </nav>
    </div>   
    <!-- <div class="row admin "> -->
      <!-- <div class="row">
        <div class="col-6" style="">
          <b><p style="font-size: large;margin-top:20px;margin-left:40px;">Search</p></b>
        </div>
      </div> -->

      <div class="row">
        <!-- <div class="col-md-1">
          <label style="margin-top:22px;margin-left:43px;"><b>Search</b></label>
        </div> -->
        <div class="col-md-1">
          <label style="margin-top:25px;margin-left:43px;"><b>Search</b></label>
        </div>
        <div class="col-md-3" style="margin-top:20px;margin-left:-10px;">
          <!-- <input type="text" id="search-input" class="form-control"> -->
          <form action="{% url 'ass_profile' %}" method="get">
            <div class="form-group">
                <div class="input-group">
                    <br/>
                    <input class="form-control" type="search" name="name_contains" placeholder="Search" />
                    <span class="input-group-append">
                    </span>
                </div>
            </div>
        </form>
        </div>
      </div>
           
        <div class="col-12">
            <table class="table table-hover table-bordered" style="font-size: small; width: 94%;margin-left: 3%;margin-top: 20px;color: black;">
                <thead style="background-color:#dce9f9;">
                    <tr>
                        <th>Sr No</th>
                        <th scope="col">Profile Name</th>
                        <th scope="col">Employee Name</th>
                        <th scope="col">From Date</th>
                        <th scope="col">To Date</th>
                        <th scope="col">Created User ID</th>
                        <th scope="col">Created Date/Time</th>
                        <th scope="col">Modified User ID</th>
                        <th scope="col">Modified Date/Time</th>
                        <th scope="col">Status</th>
                        <th scope="col">Action</th>
                        
                      </tr>
                    </thead>
                      <tbody>
                        {% for data in page_obj%}
                        <tr>
                            <td>{{data.TPFAINTID}}</td>
                            <td>{{data.TPFAPRNAME}}</td>
                            <!-- <td>{{data.TPFAEMPID_id}}</td> -->
                            <td>{{data.employee_name}}</td>
                            <td>{{data.TPFAFROMD}}</td>
                            <td>{{data.TPFATODATE}}</td>
                            <td>{{data.TPFACREDBY_id}}</td>
                            <td>{{data.TPFACREON}}</td>
                            <td>{{data.TPFAMODBY_id}}</td>
                            <td>{{data.TPFAMODON}}</td>
                            <td>{{data.TPFASTATUS}}</td>
                            <td style="color: blue;width: 50px;padding: 7px;">
                              <a href="/ass_profile_edit/{{data.TPFAINTID}}" class="btn btn-primary btn-sm">Edit</a>
                            </td> 
                        </tr>
                        {% endfor %}

              </tbody>
              
            </table> 
            <nav aria-label="Page navigation example">
  
              <ul class="pagination pagination-md justify-content-center" style="margin-top: 20px;">
          
          {% if page_obj.has_previous %}
          
              <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
          
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
          
          {% endif %}
          
          {% for i in nums %}
          
              <li class="page-item">
          
                  <a class="page-link" href="?page={{ forloop.counter }}">{{ forloop.counter }}</a>
          
              </li>
          {% endfor %}
          {% if page_obj.has_next %}
          
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next </a></li>
          
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a></li>
          
          {% endif %}
          
              </ul>
          
          </nav>
        </div>   
        <script>
// $(document).ready(function () {
//   var levelCount = 2; // Starting level number
//   var userChoices = []; // Array to store user choices
//   var newFormIdx = 2; // Initialize newFormIdx with levelCount

//   // Fetch TPFCMANID choices and store them in userChoices array
//   fetch("/get_user_choices/") // Replace with the actual URL endpoint that provides user choices
//     .then(response => response.json())
//     .then(data => {
//       userChoices = data;
//     })
//     .catch(error => {
//       console.log("Error:", error);
//     });

//   // Add form
//   $(document).on("click", ".add-form", function () {
//     var level = levelCount++;

//     var formTemplate = `
//       <div class="row">
//         <div class="col-md-2" style="margin-top: 8px;">
//           <label for="id_multiprofile-${newFormIdx}-TPFCMANID"><b>Level ${level}: </b></label>
//         </div>
//         <div class="col-md-3">
//           <select name="multiprofile-${newFormIdx}-TPFCMANID" class="form-select select-field" id="id_multiprofile-${newFormIdx}-TPFCMANID">
//             <option value="" selected>---------</option>
//           </select>
//         </div>
//         <div class="col-md-1" style="margin-top: 5px;">
//           <i class="fa-solid fa-minus fa-lg remove-form"></i>
//         </div>
//       </div>
//     `;

//     $(formTemplate).appendTo("#formset-container");
//     newFormIdx++; // Increment newFormIdx by 1
//     $("#id_multiprofile-TOTAL_FORMS").val(newFormIdx);

//     // Clone user choices and populate the select field
//     var selectField = $(`.select-field[name="multiprofile-${newFormIdx - 1}-TPFCMANID"]`);
//     var options = userChoices.map(choice => {
//       return `<option value="${choice.value}">${choice.label}</option>`;
//     });
//     selectField.append(options);

//     // Update form indexes
//     updateFormIndexes();
//   });

//   // Remove form
//   $(document).on("click", ".remove-form", function () {
//     $(this).closest(".row").remove();
//     updateFormIndexes();
//   });

//   // Update form indexes
//   function updateFormIndexes() {
//     var forms = $(".row");
//     forms.each(function (index) {
//       var formIndex = index + levelCount;
//       $(this)
//         .find(":input")
//         .each(function () {
//           var name = $(this).attr("name");
//           if (name) {
//             var updatedName = name.replace(/\d+/g, formIndex);
//             $(this).attr("name", updatedName);
//             var id = $(this).attr("id");
//             if (id) {
//               var updatedId = id.replace(/\d+/g, formIndex);
//               $(this).attr("id", updatedId);
//             }
//           }
//         });
//     });
//     $("#id_multiprofile-TOTAL_FORMS").val(forms.length);
//   }

//   // Trigger form index update initially
//   updateFormIndexes();
// });

document.addEventListener('DOMContentLoaded', () => {
  const formsetPrefix = '{{ multiprofile_formset.prefix }}';
  const formsetTotalFormsString = '{{ multiprofile_formset.total_form_count }}';
  const formsetTotalForms = parseInt(formsetTotalFormsString);
  const formsetManagementForm = document.querySelector('input[name="multiprofile-TOTAL_FORMS"]');
  const fieldContainer = document.querySelector('#formset-container');

  let fieldCount = formsetTotalForms;
  console.log(fieldCount)
  console.log(formsetTotalForms)


  const addFieldLink = document.querySelector('#add-profile');
  addFieldLink.addEventListener('click', (event) => {
    event.preventDefault();

    // Create the new field for THDPROGSTA
    const progressInput = createSelectProfile(`${fieldCount}-THDPROGSTA`, fieldCount);
    // progressInput.style.marginLeft = '500px';
    progressInput.style.marginBottom = '15px';

    // Append the progressInput to the fieldContainer
    fieldContainer.appendChild(progressInput);

    // Update the management form with the new total form count
    formsetManagementForm.setAttribute('value', `${fieldCount + 1}`);

    fieldCount++;
  });
});

function createSelectProfile(name, count) {
  const formsetPrefix = '{{ multiprofile_formset.prefix }}';
  const fullName = `${formsetPrefix}-${name}`;

  const divElement = document.createElement('div');
  divElement.classList.add('row');

  const labelColElement = document.createElement('div');
  labelColElement.classList.add('col-2');
  const labelElement = document.createElement('label');
  labelElement.classList.add('form-label');
  labelElement.textContent = `Level ${count + 2}:`;
  labelColElement.appendChild(labelElement);
  divElement.appendChild(labelColElement);

  const selectColElement = document.createElement('div');
  selectColElement.classList.add('col-3');
  const selectElement = document.createElement('select');
  selectElement.setAttribute('name', fullName);
  selectElement.classList.add('form-select');
  selectColElement.appendChild(selectElement);
  divElement.appendChild(selectColElement);

  const minusColElement = document.createElement('div');
  minusColElement.classList.add('col-1');
  const minusIcon = document.createElement('i');
  minusIcon.style.marginTop = '5px';

  minusIcon.classList.add('fa-solid', 'fa-minus', 'fa-lg', 'remove-form');
  // minusIcon.addEventListener('click', () => {
  //   divElement.parentNode.removeChild(divElement);
  // });
    $(document).on("click", ".remove-form", function () {
    $(this).closest(".row").remove();
    });
  minusColElement.appendChild(minusIcon);
  divElement.appendChild(minusColElement);

  fetch('/get_user_choices/')
    .then(response => response.json())
    .then(data => {
      data.forEach(item => {
        const option = document.createElement('option');
        option.setAttribute('value', item.value);
        option.textContent = item.label;
        selectElement.appendChild(option);
      });
    })
    .catch(error => {
      console.log('Error:', error);
    });

  return divElement;
}

        </script>
        
    <!-- </div> -->
  <!-- {% endblock content %} -->